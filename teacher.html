<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quản lý Sinh viên Thực tập</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <link rel="stylesheet" href="./css/style.css" />
    <style>
        /* Styles specific to this page can be added here if necessary */
        [contenteditable="true"]:focus,
        textarea:focus,
        input:focus {
            outline: 2px solid #3b82f6;
            background-color: #eff6ff;
            border-radius: 4px;
        }

        .info-field {
            width: 100%;
            margin-top: 0.25rem;
            padding: 0.5rem;
            border-radius: 0.375rem;
            background-color: #f3f4f6;
            border: 1px solid #d1d5db;
        }

        .modal-overlay {
            transition: opacity 0.3s ease;
        }

        .modal-container {
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
    </style>
</head>

<body class="flex h-screen">
    <aside class="sidebar w-96 min-h-screen p-5 flex flex-col">
        <div class="flex items-center mb-10">
            <img src="https://www.tlu.edu.vn/Portals/0/2014/Logo-WRU.png" alt="Logo Đại học Thủy Lợi"
                class="h-16 w-16 mr-4 flex-shrink-0 object-contain" />
            <div>
                <h1 class="university-name-primary">TRƯỜNG ĐẠI HỌC THỦY LỢI</h1>
                <p class="university-name-secondary mt-1">THUYLOI UNIVERSITY</p>
            </div>
        </div>
        <nav class="flex-grow">
            <ul>
                <li class="mb-2.5">
                    <a href="teacher.html" id="nav-home"
                        class="flex items-center py-3 px-3.5 rounded-md text-sm border border-gray-500 bg-blue-700 text-white">
                        <i class="fas fa-home w-5 mr-3.5"></i> Trang chủ
                    </a>
                </li>
                <li class="mb-2.5">
                    <button id="nav-internship-toggle"
                        class="flex items-center justify-between w-full py-3 px-3.5 rounded-md hover:bg-blue-700 text-sm border border-gray-500">
                        <span class="flex items-center">
                            <i class="fas fa-users w-5 mr-3.5"></i> Quản lý sinh viên
                        </span>
                        <i class="fas fa-chevron-down text-xs transition-transform duration-300"
                            id="nav-internship-arrow"></i>
                    </button>
                    <ul id="nav-internship-submenu" class="pl-8 mt-2 space-y-2 hidden">
                        <li>
                            <a href="teacher.html#evaluation" id="nav-evaluation"
                                class="flex items-center py-2 px-3 rounded-md hover:bg-blue-700 text-sm border border-gray-500">
                                <i class="fas fa-edit w-4 mr-2"></i> Đánh giá sinh viên
                            </a>
                        </li>
                        <li>
                            <a href="danhsach.html" id="nav-student-list"
                                class="flex items-center py-2 px-3 rounded-md hover:bg-blue-700 text-sm border border-gray-500">
                                <i class="fas fa-list-ul w-4 mr-2"></i> Danh sách sinh viên
                            </a>
                        </li>
                    </ul>
                </li>
                <li class="mb-2.5">
                    <a href="tailieu.html" id="nav-documents"
                        class="flex items-center py-3 px-3.5 rounded-md hover:bg-blue-700 text-sm border border-gray-500">
                        <i class="fas fa-upload w-5 mr-3.5"></i> Tải lên tài liệu
                    </a>
                </li>
            </ul>
        </nav>
    </aside>

    <main class="flex-1 flex flex-col">
        <header class="bg-white shadow-sm p-4 flex justify-end items-center">
            <div class="relative">
                <div id="user-menu-button" class="flex items-center cursor-pointer">
                    <img src="https://placehold.co/36x36/E2E8F0/4A5568?text=NH" alt="Avatar Nguyễn Thị Thu Hương"
                        class="h-9 w-9 rounded-full mr-2" />
                    <div>
                        <p class="text-sm font-medium text-gray-700">
                            Nguyễn Thị Thu Hương
                        </p>
                        <p class="text-xs text-gray-500">Giảng viên</p>
                    </div>
                    <i class="fas fa-chevron-down text-xs text-gray-400 ml-2"></i>
                </div>
                <div id="user-menu"
                    class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50 ring-1 ring-black ring-opacity-5">
                    <a href="login.html" id="logout-button"
                        class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left">
                        <i class="fas fa-sign-out-alt w-5 mr-2 text-gray-500"></i> Đăng
                        xuất
                    </a>
                </div>
            </div>
        </header>

        <div class="flex-1 p-6 md:p-8 lg:p-10 overflow-y-auto" id="main-content-area">
            <div id="page-home">
                <div class="bg-blue-50 border-l-4 border-blue-500 text-blue-800 p-4 rounded-r-lg mb-6">
                    <h3 class="font-bold">Chào mừng bạn quay trở lại.</h3>
                    <p>
                        Đây là những gì đang diễn ra với chương trình thực tập của sinh
                        viên.
                    </p>
                </div>
                <h3 class="text-2xl font-semibold text-gray-700 mb-6">
                    Những Con Số Nổi Bật
                </h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="stat-card">
                        <div class="flex items-center text-blue-600 mb-2">
                            <i class="fas fa-users text-3xl mr-3"></i><span class="text-4xl font-bold">5,000+</span>
                        </div>
                        <p class="text-gray-600 font-medium">Số sinh viên đang quản lý</p>
                    </div>
                    <div class="stat-card">
                        <div class="flex items-center text-green-600 mb-2">
                            <i class="fas fa-graduation-cap text-3xl mr-3"></i><span
                                class="text-4xl font-bold">1000+</span>
                        </div>
                        <p class="text-gray-600 font-medium">
                            Số doanh nghiệp đang quản lý
                        </p>
                    </div>
                    <div class="stat-card">
                        <div class="flex items-center text-purple-600 mb-2">
                            <i class="fas fa-flask text-3xl mr-3"></i><span class="text-4xl font-bold">4500+</span>
                        </div>
                        <p class="text-gray-600 font-medium">Sinh viên đang thực tập</p>
                    </div>
                    <div class="stat-card">
                        <div class="flex items-center text-red-600 mb-2">
                            <i class="fas fa-building-columns text-3xl mr-3"></i><span
                                class="text-4xl font-bold">65+</span>
                        </div>
                        <p class="text-gray-600 font-medium">Năm xây dựng & phát triển</p>
                    </div>
                </div>
            </div>
            <div id="page-evaluation" class="hidden"></div>
            <div id="page-detailed-evaluation" class="hidden">
                <div class="flex items-center gap-4 mb-6">
                    <button id="back-to-evaluation"
                        class="h-10 w-10 bg-gray-200 text-gray-800 rounded-lg font-semibold hover:bg-gray-300 transition flex items-center justify-center">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <h2 class="text-2xl font-bold text-gray-800">
                        Lời nhận xét, đánh giá sinh viên
                    </h2>
                </div>

                <div class="bg-white rounded-lg shadow-sm">
                    <div class="p-6 border-b">
                        <h3 class="text-xl font-semibold text-gray-800">
                            Thông tin cá nhân
                        </h3>
                    </div>
                    <div class="p-6 grid grid-cols-1 md:grid-cols-12 gap-6">
                        <div class="md:col-span-2 flex flex-col items-center">
                            <img src="https://placehold.co/128x128/E2E8F0/4A5568?text=SV" alt="Ảnh đại diện"
                                class="w-32 h-32 rounded-lg object-cover mb-2" />
                            <span class="text-sm text-gray-500">Ảnh đại diện</span>
                        </div>
                        <div id="edit-student-info"
                            class="md:col-span-10 grid grid-cols-1 md:grid-cols-3 gap-x-6 gap-y-4"></div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm mt-6">
                    <div class="p-6 border-b">
                        <h3 class="text-xl font-semibold text-gray-800">
                            Đánh giá nhận xét của giảng viên
                        </h3>
                    </div>
                    <div class="p-6">
                        <label for="comment-textarea" class="text-sm font-medium text-gray-700">Nhận xét về quá trình
                            thực tập</label>
                        <textarea id="comment-textarea" rows="6"
                            class="w-full mt-2 p-3 border rounded-md focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                </div>
                <div class="flex justify-end mt-6">
                    <button id="save-detailed-evaluation-button"
                        class="px-8 py-2.5 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition">
                        Lưu
                    </button>
                </div>
            </div>
            <div id="page-view-details" class="hidden">
                <div class="flex items-center gap-4 mb-6">
                    <button id="back-to-evaluation-from-view"
                        class="h-10 w-10 bg-gray-200 text-gray-800 rounded-lg font-semibold hover:bg-gray-300 transition flex items-center justify-center">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <h2 class="text-2xl font-bold text-gray-800">
                        Chi tiết đánh giá sinh viên
                    </h2>
                </div>

                <div class="bg-white rounded-lg shadow-sm">
                    <div class="p-6 border-b">
                        <h3 class="text-xl font-semibold text-gray-800">
                            Thông tin cá nhân
                        </h3>
                    </div>
                    <div class="p-6 grid grid-cols-1 md:grid-cols-12 gap-6">
                        <div class="md:col-span-2 flex flex-col items-center">
                            <img src="https://placehold.co/128x128/E2E8F0/4A5568?text=SV" alt="Ảnh đại diện"
                                class="w-32 h-32 rounded-lg object-cover mb-2" />
                            <span class="text-sm text-gray-500">Ảnh đại diện</span>
                        </div>
                        <div id="view-student-info"
                            class="md:col-span-10 grid grid-cols-1 md:grid-cols-3 gap-x-6 gap-y-4"></div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm mt-6">
                    <div class="p-6 border-b">
                        <h3 class="text-xl font-semibold text-gray-800">
                            Tổng hợp quá trình thực tập
                        </h3>
                    </div>
                    <div id="view-evaluation-summary" class="p-6 grid grid-cols-1 md:grid-cols-3 gap-x-6 gap-y-4"></div>
                    <div class="p-6 pt-0">
                        <label class="text-sm font-medium text-gray-500">Nhận xét về quá trình thực tập</label>
                        <textarea id="view-comment" rows="4" class="w-full mt-1 p-2 border rounded-md bg-gray-100"
                            disabled></textarea>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="error-modal"
        class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden opacity-0">
        <div
            class="modal-container bg-white w-full max-w-md rounded-lg shadow-lg p-6 relative opacity-0 transform -translate-y-10">
            <div class="flex justify-between items-center pb-3 border-b">
                <h3 class="text-lg font-bold text-gray-800">Điểm không hợp lệ</h3>
                <button id="close-error-modal-button" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="py-4">
                <p>
                    Điểm nhập vào không hợp lệ, vui lòng nhập lại. Điểm phải là số từ 0
                    đến 10.
                </p>
            </div>
            <div class="flex justify-end pt-3 border-t">
                <button id="ok-error-modal-button"
                    class="px-6 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition">
                    OK
                </button>
            </div>
        </div>
    </div>
    <div id="success-modal"
        class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden opacity-0">
        <div
            class="modal-container bg-white w-full max-w-md rounded-lg shadow-lg p-6 relative opacity-0 transform -translate-y-10">
            <div class="flex justify-between items-center pb-3 border-b">
                <h3 class="text-lg font-bold text-green-600">Lưu thành công</h3>
                <button id="close-success-modal-button" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="py-4 flex items-center">
                <i class="fas fa-check-circle w-8 h-8 text-green-500 mr-3"></i>
                <p>Dữ liệu đã được cập nhật thành công.</p>
            </div>
            <div class="flex justify-end pt-3 border-t">
                <button id="ok-success-modal-button"
                    class="px-6 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition">
                    OK
                </button>
            </div>
        </div>
    </div>
    <div id="detailed-success-modal"
        class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden opacity-0">
        <div
            class="modal-container bg-white w-full max-w-md rounded-lg shadow-lg p-6 relative opacity-0 transform -translate-y-10">
            <div class="flex justify-between items-center pb-3 border-b">
                <h3 class="text-lg font-bold text-green-600">Đánh giá thành công</h3>
                <button id="close-detailed-success-modal-button" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="py-4 flex items-center">
                <i class="fas fa-check-circle w-8 h-8 text-green-500 mr-3"></i>
                <p>Đánh giá sinh viên thực tập thành công.</p>
            </div>
            <div class="flex justify-end pt-3 border-t">
                <button id="ok-detailed-success-modal-button"
                    class="px-6 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition">
                    OK
                </button>
            </div>
        </div>
    </div>

    <script src="./js/script.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const STORAGE_KEY = "studentMasterList";
            const loadStudentsFromStorage = () =>
                JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
            const saveStudentsToStorage = (data) =>
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            let studentDatabase = loadStudentsFromStorage();
            let currentStudentId = null;

            const pages = {
                home: document.getElementById("page-home"),
                evaluation: document.getElementById("page-evaluation"),
                detailedEvaluation: document.getElementById(
                    "page-detailed-evaluation"
                ),
                viewDetails: document.getElementById("page-view-details"),
            };

            const showPage = (pageName) => {
                Object.values(pages).forEach((p) => p.classList.add("hidden"));
                if (pages[pageName]) {
                    if (pageName === "evaluation") populateEvaluationPage();
                    pages[pageName].classList.remove("hidden");
                }
            };

            const populateEvaluationPage = () => {
                const container = pages.evaluation;
                studentDatabase = loadStudentsFromStorage();
                const studentIds = Object.keys(studentDatabase);
                container.innerHTML = `<h2 class="text-2xl font-bold text-gray-800 mb-6">Tổng hợp đánh giá sinh viên thực tập</h2>`;

                if (studentIds.length === 0) {
                    container.innerHTML += `<div class="flex flex-col items-center justify-center h-96 text-center text-gray-500"><i class="fas fa-user-slash fa-4x mb-4"></i><p class="text-lg">KHÔNG CÓ SINH VIÊN NÀO CẦN ĐÁNH GIÁ</p></div>`;
                } else {
                    const tableRows = studentIds
                        .map((id, index) => {
                            const s = studentDatabase[id];
                            const statusClass =
                                s.status === "Hoàn thành"
                                    ? "badge badge-success"
                                    : "badge badge-warning";
                            return `<tr data-student-id="${id}" class="bg-white border-b hover:bg-gray-50"><td class="py-3 px-4">${index + 1
                                }</td><td class="py-3 px-4 font-medium">${s.name
                                }</td><td class="py-3 px-4">${s.dob || ""
                                }</td><td class="py-3 px-4">${s.gender || ""
                                }</td><td class="py-3 px-4 score-cell" contenteditable="true">${s.scores?.gd1 || "-"
                                }</td><td class="py-3 px-4 score-cell" data-score-type="gd2" contenteditable="true">${s.scores?.gd2 || "-"
                                }</td><td class="py-3 px-4 score-cell" data-score-type="gd3" contenteditable="true">${s.scores?.gd3 || "-"
                                }</td><td class="py-3 px-4 attitude-cell" contenteditable="true">${s.attitude || "-"
                                }</td><td class="py-3 px-4"><span class="${statusClass}">${s.status || "Đang thực hiện"
                                }</span></td><td class="py-3 px-4 company-cell" contenteditable="true">${s.company || ""
                                }</td><td class="py-3 px-4 flex gap-2"><button class="text-blue-600 hover:text-blue-800 view-btn"><i class="fas fa-eye"></i></button><button class="text-green-600 hover:text-green-800 edit-btn"><i class="fas fa-edit"></i></button></td></tr>`;
                        })
                        .join("");
                    container.innerHTML += `<div class="bg-white p-4 rounded-lg shadow-sm"><div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-4"><div class="relative w-full md:w-auto"><i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"></i><input type="text" placeholder="Tìm kiếm..." class="w-full md:w-64 pl-10 pr-4 py-2 border rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"></div><div class="flex items-center gap-4"><select class="border rounded-lg py-2 px-3 bg-gray-50"><option>2024 - 2025</option><option>2023 - 2024</option></select></div></div><div class="overflow-x-auto"><table class="w-full text-sm text-left text-gray-600"><thead class="bg-gray-100 text-xs text-gray-700 uppercase"><tr><th class="py-3 px-4">STT</th><th class="py-3 px-4">Họ và tên</th><th class="py-3 px-4">Ngày sinh</th><th class="py-3 px-4">Giới tính</th><th class="py-3 px-4">Điểm GĐ 1</th><th class="py-3 px-4">Điểm GĐ 2</th><th class="py-3 px-4">Điểm GĐ 3</th><th class="py-3 px-4">Thái độ TT</th><th class="py-3 px-4">Trạng thái</th><th class="py-3 px-4">Doanh nghiệp</th><th class="py-3 px-4">Hành động</th></tr></thead><tbody id="evaluation-table-body">${tableRows}</tbody></table></div></div><div class="flex justify-end mt-6"><button id="save-evaluation-button" class="px-6 py-2.5 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition">Lưu thay đổi</button></div>`;
                }
            };

            const showModal = (modal) => {
                modal.classList.remove("hidden");
                setTimeout(() => {
                    modal.classList.remove("opacity-0");
                    modal
                        .querySelector(".modal-container")
                        .classList.remove("opacity-0", "-translate-y-10");
                }, 10);
            };
            const hideModal = (modal, cb) => {
                modal.classList.add("opacity-0");
                modal
                    .querySelector(".modal-container")
                    .classList.add("opacity-0", "-translate-y-10");
                setTimeout(() => {
                    modal.classList.add("hidden");
                    if (cb) cb();
                }, 300);
            };
            const errorModal = document.getElementById("error-modal");
            document
                .getElementById("close-error-modal-button")
                .addEventListener("click", () => hideModal(errorModal));
            document
                .getElementById("ok-error-modal-button")
                .addEventListener("click", () => hideModal(errorModal));
            const successModal = document.getElementById("success-modal");
            document
                .getElementById("close-success-modal-button")
                .addEventListener("click", () => hideModal(successModal));
            document
                .getElementById("ok-success-modal-button")
                .addEventListener("click", () => hideModal(successModal));
            const detailedSuccessModal = document.getElementById(
                "detailed-success-modal"
            );
            const hideDetailedSuccessAndNavigate = () =>
                hideModal(detailedSuccessModal, () => showPage("evaluation"));
            document
                .getElementById("close-detailed-success-modal-button")
                .addEventListener("click", hideDetailedSuccessAndNavigate);
            document
                .getElementById("ok-detailed-success-modal-button")
                .addEventListener("click", hideDetailedSuccessAndNavigate);

            const createInfoField = (label, value) =>
                `<div><label class="text-sm font-medium text-gray-500">${label}</label><input type="text" value="${value || ""
                }" class="info-field" disabled></div>`;
            const populateEditPage = (studentId) => {
                const student = studentDatabase[studentId];
                if (!student) return;
                document.getElementById(
                    "edit-student-info"
                ).innerHTML = `${createInfoField(
                    "Họ và tên",
                    student.name
                )}${createInfoField("Địa chỉ", student.address)}${createInfoField(
                    "Lớp",
                    student.class
                )}${createInfoField("Ngày sinh", student.dob)}${createInfoField(
                    "Số điện thoại",
                    student.phone
                )}${createInfoField("Khoa", student.faculty)}${createInfoField(
                    "Dân tộc",
                    student.ethnicity || "Kinh"
                )}${createInfoField(
                    "Mã sinh viên",
                    student.studentId
                )}${createInfoField("Số CCCD", student.cccd)}`;
                document.getElementById("comment-textarea").value =
                    student.comment || "";
            };
            const populateViewPage = (studentId) => {
                const student = studentDatabase[studentId];
                if (!student) return;
                document.getElementById(
                    "view-student-info"
                ).innerHTML = `${createInfoField(
                    "Họ và tên",
                    student.name
                )}${createInfoField("Địa chỉ", student.address)}${createInfoField(
                    "Lớp",
                    student.class
                )}${createInfoField("Ngày sinh", student.dob)}${createInfoField(
                    "Số điện thoại",
                    student.phone
                )}${createInfoField("Khoa", student.faculty)}${createInfoField(
                    "Dân tộc",
                    student.ethnicity || "Kinh"
                )}${createInfoField(
                    "Doanh nghiệp đang thực tập",
                    student.company
                )}${createInfoField("Số CCCD", student.cccd)}`;
                document.getElementById(
                    "view-evaluation-summary"
                ).innerHTML = `${createInfoField(
                    "Điểm giai đoạn 1",
                    student.scores?.gd1
                )}${createInfoField(
                    "Thái độ thực tập",
                    student.attitude
                )}${createInfoField(
                    "Tên doanh nghiệp thực tập",
                    student.company
                )}${createInfoField(
                    "Điểm giai đoạn 2",
                    student.scores?.gd2
                )}${createInfoField(
                    "Trạng thái thực tập",
                    student.status
                )}${createInfoField("Điểm giai đoạn 3", student.scores?.gd3)}`;
                document.getElementById("view-comment").value = student.comment || "";
            };

            document
                .getElementById("nav-evaluation")
                .addEventListener("click", (e) => {
                    e.preventDefault();
                    showPage("evaluation");
                });
            document
                .getElementById("back-to-evaluation")
                .addEventListener("click", () => showPage("evaluation"));
            document
                .getElementById("back-to-evaluation-from-view")
                .addEventListener("click", () => showPage("evaluation"));

            document
                .getElementById("main-content-area")
                .addEventListener("click", (e) => {
                    if (e.target.id === "save-evaluation-button") {
                        let isValid = true;
                        document
                            .querySelectorAll("#evaluation-table-body tr")
                            .forEach((row) => {
                                const id = row.dataset.studentId;
                                if (!studentDatabase[id]) return;
                                if (!studentDatabase[id].scores)
                                    studentDatabase[id].scores = {};
                                row.querySelectorAll(".score-cell").forEach((cell) => {
                                    const value = cell.textContent.trim();
                                    const scoreType = cell.dataset.scoreType;
                                    if (value === "" || value === "-") {
                                        studentDatabase[id].scores[scoreType] = "-";
                                        return;
                                    }
                                    const numericValue = parseFloat(value);
                                    if (
                                        isNaN(numericValue) ||
                                        numericValue < 0 ||
                                        numericValue > 10
                                    ) {
                                        isValid = false;
                                        cell.focus();
                                    } else {
                                        studentDatabase[id].scores[scoreType] = value;
                                    }
                                });
                                studentDatabase[id].attitude =
                                    row.querySelector(".attitude-cell")?.textContent.trim() ||
                                    "";
                                studentDatabase[id].company =
                                    row.querySelector(".company-cell")?.textContent.trim() ||
                                    "";
                            });
                        if (!isValid) showModal(errorModal);
                        else {
                            saveStudentsToStorage(studentDatabase);
                            showModal(successModal);
                        }
                    }

                    const targetRow = e.target.closest("tr");
                    if (!targetRow) return;
                    currentStudentId = targetRow.dataset.studentId;
                    if (e.target.closest(".edit-btn")) {
                        e.preventDefault();
                        populateEditPage(currentStudentId);
                        showPage("detailedEvaluation");
                    } else if (e.target.closest(".view-btn")) {
                        e.preventDefault();
                        populateViewPage(currentStudentId);
                        showPage("viewDetails");
                    }
                });

            document
                .getElementById("save-detailed-evaluation-button")
                .addEventListener("click", () => {
                    if (currentStudentId && studentDatabase[currentStudentId]) {
                        studentDatabase[currentStudentId].comment =
                            document.getElementById("comment-textarea").value;
                        saveStudentsToStorage(studentDatabase);
                    }
                    showModal(detailedSuccessModal);
                });

            const hash = window.location.hash.substring(1);
            if (hash === "evaluation") {
                showPage("evaluation");
                document
                    .getElementById("nav-student-submenu")
                    .classList.remove("hidden");
                document
                    .getElementById("nav-student-arrow")
                    .classList.add("rotate-180");
            } else {
                showPage("home");
            }
        });
    </script>
</body>

</html>